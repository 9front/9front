#!/bin/rc

# desc: set system password for auth, invalidate nvram
# prereq: systype copydist

nvram=`{echo `{basename -d $fs}^/nvram}

switch($1) {
case checkdone
	if(! ~ $syst cpu || ! grep trust $nvram){
		authsetup=ready
		export authsetup
	}
case go
	echo
	echo 'Setup keyfs and provide a password for the machine'
	echo

	auth/keyfs

	if(! grep trust $nvram)
		echo 'trust, but verify' >$nvram >[2=1]

	echo
	echo 'You will be asked to enter an authid, authdom, secstore key,'
	echo 'and password upon next boot. The authid is the hostowner,'
	echo 'in this case '$user'. The authdom is the domain from your'
	echo 'network configuration. The secstore key and password should'
	echo 'be a secret password of eight characters or greater in length.'
	echo 'Remember the password, you will need to use it again when'
	echo 'setting the password for '$user' on the auth server.'
	echo

	authsetup=done
	export authsetup
}
